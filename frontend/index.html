<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Qanda User GPT</title>
    <link rel="stylesheet" href="styles.css?v=20250124-1332-modal-fix">
</head>
<body>
    <button class="add-data-btn" onclick="showAddDataModal()">Add Data Source</button>
    
    <!-- Add Data Source Modal -->
    <div id="add-data-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Data Source</h2>
                <span class="close" onclick="hideAddDataModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="add-data-form">
                    <div class="form-group">
                        <label for="data-title">Data Source Title</label>
                        <input type="text" id="data-title" name="title" placeholder="e.g., Student Survey 2024" required>
                    </div>
                    <div class="form-group">
                        <label>Data Type</label>
                        <div class="data-type-buttons">
                            <button type="button" class="type-btn active" id="type-survey" onclick="selectDataType('survey')">
                                <span class="type-icon">üìä</span>
                                <span class="type-label">Survey Data</span>
                                <span class="type-desc">Google Sheets</span>
                            </button>
                            <button type="button" class="type-btn" id="type-interview" onclick="selectDataType('interview')">
                                <span class="type-icon">üìù</span>
                                <span class="type-label">Interview Data</span>
                                <span class="type-desc">Google Docs</span>
                            </button>
                        </div>
                        <input type="hidden" id="data-type" name="type" value="survey" required>
                    </div>
                    <div class="form-group" id="sheet-url-group">
                        <label for="sheet-url">Google Sheets URL</label>
                        <input type="url" id="sheet-url" name="url" placeholder="https://docs.google.com/spreadsheets/d/.../edit#gid=..." required>
                        <small>Include the full URL with the #gid parameter</small>
                    </div>
                    <div class="form-group" id="doc-url-group" style="display: none;">
                        <label for="doc-url">Google Docs URL</label>
                        <input type="url" id="doc-url" name="doc_url" placeholder="https://docs.google.com/document/d/.../edit">
                        <small>Paste the Google Docs share URL</small>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="btn-cancel" onclick="hideAddDataModal()">Cancel</button>
                        <button type="submit" class="btn-submit">Add Data Source</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Edit Data Source Modal -->
    <div id="edit-data-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Data Source</h2>
                <span class="close" onclick="hideEditDataModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="edit-data-form">
                    <input type="hidden" id="edit-gid" name="gid">
                    <input type="hidden" id="edit-spreadsheet-id" name="spreadsheet_id">
                    <input type="hidden" id="edit-is-default" name="is_default">
                    <input type="hidden" id="edit-source-type" name="source_type">
                    <input type="hidden" id="edit-document-id" name="document_id">
                    <div class="form-group">
                        <label for="edit-data-title">Data Source Title</label>
                        <input type="text" id="edit-data-title" name="title" placeholder="e.g., Student Survey 2024" required>
                    </div>
                    <div class="form-group" id="edit-url-group">
                        <label for="edit-sheet-url">Google Sheets URL</label>
                        <input type="url" id="edit-sheet-url" name="url" placeholder="https://docs.google.com/spreadsheets/d/.../edit#gid=...">
                        <small>Include the full URL with the #gid parameter</small>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="btn-cancel" onclick="hideEditDataModal()">Cancel</button>
                        <button type="submit" class="btn-submit">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Data Sources</h2>
            </div>
            <div class="sheet-tabs">
                <!-- Data sources will be loaded dynamically -->
            </div>
        </aside>
        <div class="main-content">
            <header>
                <h1>Qanda User GPT</h1>
                <p class="subtitle">ÌïôÏÉùÌïúÌÖå Í∂ÅÍ∏àÌïú Ï†êÎì§ÏùÑ ÏïÑÎ¨¥Í±∞ÎÇò Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî</p>
            </header>

        <main>
            <div class="main-container">
                <!-- Data Overview Panel -->
                <div class="data-overview-panel">
                    <div class="panel-header">
                <h3 id="data-overview-title">ÌïôÏÉù ÏÑ±Ìñ• Îç∞Ïù¥ÌÑ∞</h3>
                        <button class="refresh-btn" onclick="refreshDataOverview()" title="Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                            </svg>
                        </button>
                    </div>
                    <div id="data-overview" class="data-overview-content">
                        <div class="loading-container">
                            <div class="loading"></div>
                            <p>Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï§ë...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Container -->
                <div class="chat-container">
                    <div id="chat-messages" class="chat-messages">
                        <div class="message bot-message">
                            <div class="message-content">
                                ÏïàÎÖïÌïòÏÑ∏Ïöî! "ÌïôÏÉù ÏÑ±Ìñ•" Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Í∂ÅÍ∏àÌïú Ï†êÏùÑ Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî.
                            </div>
                        </div>
                    </div>

                    <div class="input-container">
                        <input 
                            type="text" 
                            id="user-input" 
                            placeholder="ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
                            autofocus
                        >
                        <button id="send-button" onclick="sendMessage()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </main>
        </div>
    </div>

    <script src="script.js?v=20250124-1332-modal-fix"></script>
    <!-- Deployment Version: 2025-01-24-1332-modal-fix -->
    <script>
        console.log('Page loaded at:', new Date().toISOString());
        console.log('Version: 2025-01-24-1332-modal-fix');
        console.log('Domain:', window.location.hostname);
        // Force reload if old version detected
        if (localStorage.getItem('app-version') !== '20250124-1332') {
            localStorage.setItem('app-version', '20250124-1332');
            console.log('New version detected, clearing cache...');
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }
            // Force reload page after cache clear
            setTimeout(() => {
                window.location.reload(true);
            }, 100);
        }
    </script>
</body>
</html>
